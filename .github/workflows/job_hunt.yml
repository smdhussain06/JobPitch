name: JobHunt Autopilot

on:
  schedule:
    # Every hour â€” each batch takes ~30 min (15 emails Ã— 2-min drip)
    # ~24 runs/day Ã— 15 emails = ~360/day, safely under 450 cap
    - cron: '0 * * * *'
  workflow_dispatch:
    # Allow manual trigger from the Actions tab

jobs:
  send-pitch:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # â”€â”€ 1. Checkout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Checkout repository
        uses: actions/checkout@v4

      # â”€â”€ 2. Setup Python â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # â”€â”€ 3. Install dependencies â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Install dependencies
        run: pip install -r requirements.txt

      # â”€â”€ 4. Verify Secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Verify Secrets
        run: |
          echo "ğŸ” Verifying required secrets..."
          MISSING=""
          if [ -z "$OPENROUTER_API_KEY" ]; then MISSING="$MISSING OPENROUTER_API_KEY"; fi
          if [ -z "$SMTP_EMAIL" ]; then MISSING="$MISSING SMTP_EMAIL"; fi
          if [ -z "$SMTP_PASSWORD" ]; then MISSING="$MISSING SMTP_PASSWORD"; fi
          if [ -z "$GH_TOKEN" ]; then MISSING="$MISSING GH_TOKEN"; fi
          if [ -n "$MISSING" ]; then
            echo "âŒ Missing secrets:$MISSING"
            exit 1
          fi
          echo "âœ… All secrets are set."
        env:
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          SMTP_EMAIL: ${{ secrets.SMTP_EMAIL }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}

      # â”€â”€ 5. Run Autopilot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Run JobHunt Autopilot
        run: python -u main.py
        env:
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          SMTP_EMAIL: ${{ secrets.SMTP_EMAIL }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          GITHUB_REPO: ${{ github.repository }}
          SENDER_NAME: ${{ secrets.SENDER_NAME }}
          SENDER_PHONE: ${{ secrets.SENDER_PHONE }}
          SENDER_LINKEDIN: ${{ secrets.SENDER_LINKEDIN }}
          SENDER_PORTFOLIO: ${{ secrets.SENDER_PORTFOLIO }}
